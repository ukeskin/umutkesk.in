import { ImageResponse } from '@vercel/og';


export const config = {
  runtime: 'experimental-edge',
};

export default function handler(req) {
  try {
    const { searchParams } = new URL(req.url);

    // ?title=<title>
    const hasTitle = searchParams.has('title');
    const title = hasTitle
      ? searchParams.get('title')?.slice(0, 100)
      : 'My default title';

    return new ImageResponse(
      (
        <div
          style={{
            height: '100%',
            width: '100%',
            display: 'flex',
            textAlign: 'center',
            alignItems: 'center',
            justifyContent: 'center',
            flexDirection: 'column',
            flexWrap: 'nowrap',
            backgroundColor: 'white',
            backgroundImage: 'radial-gradient(circle at 25px 25px, lightgray 2%, transparent 0%), radial-gradient(circle at 75px 75px, lightgray 2%, transparent 0%)',
            backgroundSize: '100px 100px',
          }}
        >
          <div
            style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
            }}
          >
            <svg
              width={hasTitle ? 300 : 400}
              xmlns="http://www.w3.org/2000/svg" viewBox="116.912 115.565 2143.927 717.298" fill="red">
              <path d="M 1144.048 1115.107 L 1303.106 1115.107 L 1303.106 1525.078 C 1303.106 1590.143 1305.078 1632.312 1309.012 1651.588 C 1315.821 1682.568 1332.024 1707.433 1357.645 1726.194 C 1383.254 1744.956 1418.279 1754.336 1462.688 1754.336 C 1507.832 1754.336 1552.63 1745.469 1575.554 1727.747 C 1598.476 1710.014 1612.274 1688.243 1616.931 1662.425 C 1621.59 1636.606 1623.919 1593.75 1623.919 1533.859 L 1623.919 976.065 L 1782.965 976.505 L 1782.965 1512.688 C 1782.965 1603.559 1778.664 1667.767 1770.072 1705.28 C 1761.468 1742.803 1745.623 1774.478 1722.52 1800.297 C 1699.408 1826.105 1668.517 1846.675 1629.825 1861.999 C 1591.133 1877.313 1540.629 1884.969 1478.301 1884.969 C 1403.067 1884.969 1335.256 1876.627 1296.387 1859.933 C 1257.515 1843.239 1226.804 1821.543 1204.236 1794.868 C 1181.67 1768.192 1166.804 1740.222 1159.639 1710.966 C 1149.24 1667.585 1144.192 1676.067 1144.192 1591.384 L 1144.048 1115.107 Z" style="fill-rule: nonzero; fill: rgb(255, 0, 0);" transform="matrix(0.658423, 0, 0, 0.669375, 912.436462, -430.234802)" />
              <path d="M -1208.227 918.672 C -1208.227 897.38 -1199.179 877.058 -1183.265 862.617 C -1167.363 848.177 -1146.044 840.936 -1124.47 842.641 C -1124.459 842.641 -1124.459 842.643 -1124.459 842.643 C -1124.459 842.643 -1124.459 842.641 -1124.459 842.641 C -1106.26 841.474 -1088.375 847.735 -1075.013 859.954 C -1061.663 872.17 -1054.018 889.263 -1053.883 907.203 C -1052.568 1084.814 -1049.169 1543.63 -1049.169 1543.63 C -1049.169 1605.696 -1047.208 1645.93 -1043.263 1664.318 C -1036.454 1693.875 -1020.251 1717.599 -994.632 1735.499 C -969.023 1753.398 -934.009 1762.347 -889.587 1762.347 C -844.444 1762.347 -811.77 1752.386 -788.847 1735.478 C -765.924 1718.56 -752.128 1697.789 -747.469 1673.156 C -742.811 1648.523 -740.492 1607.637 -740.492 1550.495 L -740.492 1150.979 L -581.435 1150.979 L -581.435 1530.297 C -581.435 1616.996 -585.737 1678.254 -594.328 1714.044 C -602.932 1749.842 -618.779 1780.063 -641.891 1804.695 C -664.992 1829.317 -695.895 1848.944 -734.575 1863.564 C -773.267 1878.173 -822.423 1886.98 -884.751 1886.98 C -959.974 1886.98 -1017.019 1879.022 -1055.89 1863.093 C -1094.76 1847.166 -1125.473 1826.477 -1148.05 1801.017 C -1170.617 1775.567 -1185.484 1748.882 -1192.648 1720.97 C -1203.035 1679.593 -1208.227 1618.507 -1208.227 1537.714 L -1208.227 918.672 Z" style="fill-rule: nonzero; fill: rgb(255, 0, 0);" transform="matrix(0.658423, 0, 0, 0.669375, 912.436462, -430.234802)" />
              <path d="M -740.467 922.323 C -740.467 901.577 -732.088 881.682 -717.178 867.014 C -702.255 852.344 -682.029 844.102 -660.944 844.102 L -660.933 844.102 C -639.85 844.102 -619.623 852.344 -604.701 867.014 C -589.79 881.682 -581.409 901.577 -581.409 922.323 L -581.409 1235.24 C -581.409 1297.316 -579.437 1337.549 -575.503 1355.94 C -568.695 1385.496 -552.491 1409.219 -526.872 1427.118 C -501.263 1445.018 -466.236 1453.968 -421.828 1453.968 C -376.685 1453.968 -342.651 1445.509 -319.727 1428.6 C -296.803 1411.681 -283.007 1390.91 -278.35 1366.279 C -273.691 1341.646 -271.374 1300.759 -271.374 1243.618 L -269.2 842.205 L -112.316 844.102 L -112.316 1223.42 C -112.316 1239.675 -110.311 1257.022 -110.61 1271.489 C -111.925 1334.179 -118.222 1378.079 -125.21 1407.165 C -133.812 1442.964 -149.659 1473.186 -172.772 1497.817 C -195.874 1522.44 -226.775 1542.065 -265.456 1556.685 C -304.149 1571.296 -354.652 1578.6 -416.981 1578.6 C -492.214 1578.6 -549.259 1570.641 -588.13 1554.714 C -627 1538.786 -657.713 1518.087 -680.279 1492.637 C -702.847 1467.188 -717.711 1440.502 -724.878 1412.591 C -735.275 1371.203 -740.467 1310.117 -740.467 1229.335 L -740.467 922.323 Z" style="fill-rule: nonzero; fill: rgb(255, 0, 0);" transform="matrix(-0.658423, 0, 0, -0.669375, 352.08777, 1190.191505)" />
              <path d="M 200.116 922.684 C 200.116 901.938 208.497 882.043 223.407 867.374 C 238.33 852.704 258.556 844.463 279.64 844.463 L 279.652 844.463 C 300.735 844.463 320.962 852.704 335.884 867.374 C 350.795 882.043 359.175 901.938 359.175 922.684 L 359.175 1235.601 C 359.175 1297.677 361.148 1337.91 365.082 1356.301 C 371.89 1385.857 388.093 1409.58 413.713 1427.479 C 439.322 1445.379 474.347 1454.329 518.756 1454.329 C 563.9 1454.329 597.934 1445.87 620.858 1428.96 C 643.78 1412.042 657.578 1391.271 662.235 1366.64 C 666.894 1342.007 669.211 1301.12 669.211 1243.979 L 671.385 842.566 L 828.269 844.463 L 828.269 1223.78 C 828.269 1240.035 830.274 1257.382 829.975 1271.85 C 828.66 1334.54 822.363 1378.44 815.375 1407.526 C 806.773 1443.325 790.926 1473.547 767.813 1498.178 C 744.711 1522.801 713.81 1542.426 675.129 1557.046 C 636.436 1571.657 585.933 1578.961 523.604 1578.961 C 448.371 1578.961 391.324 1571.002 352.455 1555.075 C 313.585 1539.147 282.872 1518.448 260.306 1492.998 C 237.738 1467.549 222.872 1440.863 215.707 1412.952 C 205.31 1371.564 200.116 1310.478 200.116 1229.696 L 200.116 922.684 Z" style="fill-rule: nonzero; fill: rgb(255, 0, 0);" transform="matrix(-0.658423, 0, 0, -0.669375, 1590.692193, 1190.674906)" />
              <path d="M -272.729 914.172 C -272.729 894.33 -264.381 875.371 -249.672 861.793 C -234.961 848.217 -215.193 841.231 -195.067 842.491 C -195.067 842.491 -195.067 842.491 -195.067 842.491 C -195.067 842.491 -195.067 842.491 -195.067 842.491 C -149.298 845.356 -113.672 882.702 -113.672 927.806 C -113.672 1136.59 -113.672 1391.178 -113.672 1391.178 C -113.672 1453.254 -111.698 1493.488 -107.765 1511.878 C -100.955 1541.435 -84.752 1565.157 -59.132 1583.057 C -33.524 1600.956 1.501 1609.907 45.91 1609.907 C 91.055 1609.907 125.088 1601.447 148.012 1584.538 C 170.935 1567.619 184.731 1546.85 189.389 1522.217 C 194.048 1497.585 200.49 1459.467 200.49 1402.326 L 200.767 1362.94 L 199.018 1344.632 L 362.188 1504.092 L 355.424 1379.358 C 355.424 1466.056 351.123 1527.315 342.53 1563.103 C 333.926 1598.904 318.081 1629.124 294.967 1653.757 C 271.866 1678.378 240.964 1698.004 202.283 1712.624 C 163.591 1727.234 113.086 1734.539 50.759 1734.539 C -24.474 1734.539 -81.521 1726.58 -120.391 1710.653 C -159.26 1694.724 -189.973 1674.025 -212.54 1648.577 C -235.107 1623.127 -249.973 1596.44 -257.138 1568.529 C -264.058 1540.964 -270.366 1508.977 -272.684 1463.931 C -273.843 1441.343 -272.729 1412.255 -272.729 1385.274 L -272.729 914.172 Z" style="fill-rule: nonzero; fill: rgb(255, 0, 0);" transform="matrix(-0.658423, 0, 0, -0.669375, 971.020965, 1294.667444)" />
              <path d="M 667.84 842.707 L 826.898 842.707 L 826.898 1233.845 C 826.898 1295.921 828.87 1336.154 832.804 1354.543 C 839.612 1384.1 855.817 1407.824 881.437 1425.723 C 907.045 1443.623 942.071 1452.572 986.479 1452.572 C 1031.624 1452.572 1065.658 1444.112 1088.581 1427.205 C 1111.504 1410.286 1125.3 1389.515 1129.959 1364.882 C 1134.616 1340.251 1141.057 1302.133 1141.057 1244.991 L 1141.337 1205.606 L 1139.587 1187.298 L 1302.757 1346.759 L 1295.993 1222.025 C 1295.993 1308.722 1291.69 1369.981 1283.099 1405.77 C 1274.495 1441.569 1258.648 1471.789 1235.536 1496.422 C 1212.435 1521.043 1181.532 1540.67 1142.852 1555.29 C 1104.16 1569.899 1053.655 1577.205 991.327 1577.205 C 916.095 1577.205 859.048 1569.246 820.178 1553.318 C 781.307 1537.391 750.596 1516.692 728.028 1491.242 C 705.462 1465.793 690.596 1439.107 683.431 1411.194 C 676.509 1383.631 670.203 1351.642 667.885 1306.598 C 666.726 1284.008 667.84 1254.922 667.84 1227.939 L 667.84 842.707 Z" style="fill-rule: nonzero; fill: rgb(255, 0, 0);" transform="matrix(-0.658423, 0, 0, -0.669375, 2209.605535, 1189.593708)" />
              <path d="M 1782.128 634.734 C 1782.128 590.118 1745.345 553.936 1699.976 553.936 C 1654.607 553.936 1617.823 590.118 1617.823 634.734 L 1617.823 1157.65 C 1617.823 1202.267 1654.607 1238.453 1699.976 1238.453 C 1745.345 1238.453 1782.128 1202.267 1782.128 1157.65 C 1782.128 1025.919 1782.128 766.43 1782.128 634.734 Z" style="fill: rgb(255, 0, 0);" transform="matrix(0, 0.658423, -0.669375, 0, 2631.629724, -949.647701)" />
            </svg>
          </div>
          <div
            style={{
              display: 'flex',
              fontSize: 40,
              fontStyle: 'normal',
              color: 'black',
              marginTop: 30,
              lineHeight: 1.8,
              whiteSpace: 'pre-wrap',
            }}
          >
            <b>{title}</b>
          </div>
        </div>


      ),
      {
        width: 1200,
        height: 630,
      },
    );
  } catch (e) {
    console.log(`${e.message}`);
    return new Response(`Failed to generate the image`, {
      status: 500,
    });
  }
}